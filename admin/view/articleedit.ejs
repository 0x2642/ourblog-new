<% include ./layout/header.ejs %>

<div id="container">
	<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
		<h1 class="page-header">Article</h1>
		<form class="form-horizontal" id="article_form">
			<input type="hidden" name="_id" value="" />
			<div class="form-group form-group-lg">
			  <label class="col-sm-1 control-label" for="title">Title</label>
			  <div class="col-sm-8">
			  	<input type="text" name="title" id="title" class="form-control" placeholder="Title" />
			  </div>
			</div>
			<div class="form-group form-group-lg">
			  <label class="col-sm-1 control-label" for="description">Description</label>
			  <div class="col-sm-8">
			  	<input type="text" name="description" id="description" class="form-control" placeholder="Description" />
			  </div>	
			</div>
			<div class="form-group form-group-lg">
			  <label class="col-sm-1 control-label" for="thumb">Thumb</label>
			  <div class="col-sm-8">
			  	<input type="text"  name="thumb"  id="thumb" class="form-control" placeholder="Thumb" />
			  </div>
			</div>
			<div class="form-group form-group-lg">
			  <label class="col-sm-1 control-label" for="tags">Tags</label>
			  <div class="col-sm-8">
			  	<input type="text"  name="tags" id="tags" class="form-control" placeholder="Tags">
			  </div>
			</div>
			<div class="form-group form-group-lg">
				<label class="col-sm-1 control-label" for="status">Status</label>
				<div class="col-sm-8">
					<select class="form-control" name="status" id="status">
						<%  for(s in status){ %>
						<option value="<%= s %>" ><%= status[s] %></option>
						<% } %>
					</select>
				</div>
			</div>
			<div class="input-group  input-group-lg col-sm-9 edit_input editormd" id="content">
			   <script type="text/markdown">###Hello world!</script>
			</div>	
			<button type="button" id="save_btn" class="btn btn-primary btn-lg col-sm-12">Save</button>						
		</form>
	</div>
</div>
<link rel="stylesheet" href="../bower_components/editor.md/css/editormd.css" />
<script src="../bower_components/editor.md/editormd.js"></script>
<script type="text/javascript">
    $(function() {
        var testEditor = editormd("content", {
                path : '../bower_components/editor.md/lib/',
                emoji:true,
                onload : function() {
                		var edit_ptr=this
                		$.ajax({
						  url: '/api/article/<%= id %>',
						  dataType: 'json',
						  cache: false,
						  success: function(data) {
						  	if (data.error_code && data.error_code!=0) {
						  		console.error("error_code:"+data.error_code, data.msg);
						  	} else {
							  	for(key in data){
							  		if($('input[name="'+key+'"]').length>0){
							  			$('input[name="'+key+'"]').val(data[key])
							  		}

							  		if($('select[name="'+key+'"]').length>0){
							  			$('select[name="'+key+'"]').val(data[key])
							  		}

							  	}
							  	edit_ptr.setMarkdown(data.content);
						  	}
						  },
						  error: function(xhr, status, err) {
						    console.error(status, err.toString());
						  }
						});
			    },
				onfullscreen : function() {
					$('nav,#sidebar,#save_btn').hide();
				},
				onfullscreenExit : function() {
					$('nav,#sidebar,#save_btn').show();
				}		    
            });
    });

    $('#save_btn').click(function(){
    	$.ajax({
				type:"POST",
				url: '/api/article',
				dataType: 'json',
				cache: false,
				data:$('#article_form').serialize(),
				success: function(data) {
					if (data.error_code && data.error_code!=0) {
						alert(data.msg);
					} else {
						location.href="/admin/articlelist";
					}
				}
		})
    	
    });

</script>
<% include ./layout/footer.ejs %>